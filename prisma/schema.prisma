generator client {
  provider = "prisma-client-js"
}

// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url  	    = env("DATABASE_URL")
  // uncomment next line if you use Prisma <5.10
  // directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  id       String @id @default(uuid())
  name     String
  email    String @unique
  phone    String @unique
  role     Role   @default(USER)
  password String
}

model ItemMaster {
  id                  String                @id @default(uuid())
  sku                 String                @unique
  name                String
  image               String
  unit                String
  price               Float                 @default(0.0)
  purchaseRequestItem PurchaseRequestItem[]
  stock               Stock?                @relation("ItemStock")
}

model Stock {
  id       String     @id @default(uuid())
  itemId   String     @unique
  quantity Int
  item     ItemMaster @relation("ItemStock", fields: [itemId], references: [id], onDelete: Cascade)
}

model PurchaseRequest {
  id         String                @id @default(uuid())
  totalQty   Int
  status     PRStatus
  totalPrice Float
  items      PurchaseRequestItem[]
}

model PurchaseRequestItem {
  id                String          @id @default(uuid())
  purchaseRequestId String
  itemId            String
  quantity          Int
  price             Float
  item              ItemMaster      @relation(fields: [itemId], references: [id], onDelete: Cascade, map: "fk_item_master")
  purchaseRequest   PurchaseRequest @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade, map: "fk_purchase_request")
}

enum Role {
  ADMIN
  MANAGER
  USER
}

enum PRStatus {
  WAITING
  PARTIAL
  COMPLETE
  OVER
  CANCEL
}
